<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사이트 관리</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body{
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
        }
        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Prevent body scroll */
        html, body {
            height: 100%;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <div class="bg-white border-b border-gray-200 px-6 py-4">
        <div class="flex items-center justify-between">
            <h1 class="text-xl font-bold text-gray-900">사이트 관리</h1>
            <div class="text-sm text-gray-500">
                HOME &gt; 관리자 &gt; 보안관리 &gt; <span class="font-medium text-gray-900">사이트 관리</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="flex" style="height: calc(100vh - 65px);">
        <!-- Left Panel: Site List -->
        <div class="w-80 bg-white border-r border-gray-200 flex flex-col h-full">
            <!-- Search Header -->
            <div class="p-4 border-b border-gray-200">
                <h2 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                    </svg>
                    사이트 목록
                </h2>
                <div class="relative">
                    <input
                        type="text"
                        id="siteSearchInput"
                        placeholder="사이트 검색..."
                        class="w-full border border-gray-300 rounded-lg pl-9 pr-4 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none"
                    />
                    <svg class="w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
            </div>

            <!-- Site List -->
            <div id="siteList" class="flex-1 overflow-y-auto min-h-0 custom-scrollbar">
                <!-- Sites will be rendered here -->
            </div>

            <!-- Site Count Footer -->
            <div class="p-3 border-t border-gray-200 bg-gray-50 flex items-center justify-between text-xs text-gray-500">
                <span>전체 사이트</span>
                <span id="siteCountDisplay" class="font-medium text-gray-700">5개</span>
            </div>
        </div>

        <!-- Right Panel: Settings -->
        <div id="rightPanel" class="flex-1 bg-gray-50 flex flex-col h-full overflow-hidden">
            <!-- Empty State -->
            <div id="emptyState" class="flex-1 flex items-center justify-center bg-gray-50 text-gray-400">
                <div class="text-center">
                    <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                    </svg>
                    <p class="text-sm">왼쪽에서 사이트를 선택하세요</p>
                </div>
            </div>

            <!-- Content Area -->
            <div id="contentArea" class="hidden flex-1 flex flex-col h-full overflow-hidden">
                <!-- Site Header -->
                <div class="bg-white border-b border-gray-200 px-6 py-4 shrink-0">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 id="selectedSiteName" class="text-lg font-bold text-gray-900">TG</h2>
                            <p id="selectedSiteManufacturer" class="text-sm text-gray-500">제조사: T G.</p>
                        </div>
                        <span class="px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700">● 활성</span>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="bg-white border-b border-gray-200 px-6 shrink-0">
                    <div class="flex">
                        <button data-tab="order" class="tab-button px-4 py-3 text-sm font-medium border-b-2 border-blue-500 text-blue-600">
                            ORDER 등록 (<span class="order-count">10</span>)
                        </button>
                        <button data-tab="product" class="tab-button px-4 py-3 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700">
                            제품 등록 (<span class="product-count">25</span>)
                        </button>
                        <button data-tab="permission" class="tab-button px-4 py-3 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700">
                            사용권한 (<span class="permission-count">18</span>)
                        </button>
                    </div>
                </div>

                <!-- Tab Content -->
                <div class="flex-1 overflow-hidden p-6 min-h-0">
                    <!-- ORDER Tab -->
                    <div id="orderTab" class="tab-content h-full">
                        <!-- Transfer List will be rendered here -->
                    </div>

                    <!-- Product Tab -->
                    <div id="productTab" class="tab-content hidden h-full">
                        <!-- Transfer List will be rendered here -->
                    </div>

                    <!-- Permission Tab -->
                    <div id="permissionTab" class="tab-content hidden h-full">
                        <!-- Permission Tree will be rendered here -->
                    </div>
                </div>

                <!-- Footer Buttons -->
                <div class="bg-white border-t border-gray-200 px-6 py-4 shrink-0 flex justify-end">
                    <button class="px-8 py-2.5 bg-blue-500 text-white rounded-lg text-sm font-medium hover:bg-blue-600" onclick="handleSave()">
                        저장
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data
        const sites = [
            { id: 'TG', name: 'TG', manufacturer: 'T G.', orderCount: 10, productCount: 25, permissionCount: 18 },
            { id: 'EPSON', name: 'EPSON', manufacturer: 'EPSON', orderCount: 5, productCount: 12, permissionCount: 10 },
            { id: 'Samsung', name: 'Samsung', manufacturer: 'Samsung', orderCount: 8, productCount: 30, permissionCount: 15 },
            { id: 'LG', name: 'LG', manufacturer: 'LG', orderCount: 3, productCount: 8, permissionCount: 12 },
            { id: 'Huawei', name: 'Huawei', manufacturer: 'Huawei', orderCount: 2, productCount: 5, permissionCount: 8 },
        ];

        const registeredOrders = [
            { id: '505182-50021379', name: 'DREAMSYS OFFICE P/M1:7700/주택은행(사판)' },
            { id: '505182-50021497', name: 'DREAMSYS OFFICE P/M1:7700/주택은행(사판)' },
            { id: '505183-50021119', name: 'DREAMSYS OFFICE P/D1:7650/기아자동차' },
            { id: '505184-50021374', name: 'DREAMSYS OFFICE P/M1:G/동대문구청' },
            { id: '505187-50021256', name: 'DREAMSYS OFFICE/S:7700/숙명여대' },
        ];

        const unregisteredOrders = [
            { id: '441-0091-99999999', name: 'TG-4480C' },
            { id: '32015624-50309043', name: 'DD376-UNIT:CI5CML-10500,8G,1TB' },
            { id: '32015625-50309044', name: 'DD376-UNIT:CI3CML-10100,8G,256G' },
            { id: '60001087-62005838', name: 'HCE-22:2I52-R004' },
            { id: '60001117-62005839', name: 'HCE-30:2I52-R001' },
        ];

        const registeredProducts = [
            { id: 'PRD-001', name: 'TG-노트북 15인치' },
            { id: 'PRD-002', name: 'TG-모니터 27인치' },
            { id: 'PRD-003', name: 'TG-프린터 복합기' },
        ];

        const unregisteredProducts = [
            { id: 'PRD-101', name: 'TG-태블릿 10인치' },
            { id: 'PRD-102', name: 'TG-키보드 무선' },
            { id: 'PRD-103', name: 'TG-마우스 무선' },
        ];

        const permissions = [
            { 
                id: 'product-info', 
                name: '제품정보', 
                checked: true, 
                children: [
                    { id: 'system', name: '시스템', checked: true },
                    { id: 'mainboard', name: '메인보드', checked: true },
                    { id: 'processor', name: '프로세서', checked: false },
                    { id: 'memory', name: '메모리', checked: true },
                    { id: 'video', name: '비디오', checked: false },
                    { id: 'sound', name: '사운드', checked: true },
                    { id: 'network', name: '네트워크', checked: true },
                    { id: 'hdd', name: '하드디스크', checked: false },
                ]
            },
            { id: 'notebook', name: '노트북', checked: true, children: [] },
            { id: 'monitor', name: '모니터', checked: true, children: [] },
            { id: 'server', name: '서버', checked: false, children: [] },
            { id: 'pda', name: 'PDA', checked: true, children: [] },
            { id: 'printer', name: '프린터', checked: true, children: [] },
            { id: 'msrw', name: 'MSRW', checked: true, children: [] },
            { id: 'pad', name: 'Pad', checked: false, children: [] },
            { id: 'reader', name: '리더기', checked: true, children: [] },
        ];

        // State
        let selectedSite = null;
        let activeTab = 'order';
        let selectedLeftItems = [];
        let selectedRightItems = [];
        let leftSearchKeyword = '';
        let rightSearchKeyword = '';
        let permissionSearchKeyword = '';
        let expandedPermissions = ['product-info'];

        // Initialize
        function init() {
            renderSiteList();
            setupEventListeners();
        }

        // Render site list
        function renderSiteList(searchKeyword = '') {
            const siteListEl = document.getElementById('siteList');
            const filteredSites = sites.filter(site =>
                site.name.toLowerCase().includes(searchKeyword.toLowerCase())
            );

            siteListEl.innerHTML = filteredSites.map(site => `
                <div
                    class="site-item px-4 py-3 border-b border-gray-100 cursor-pointer ${selectedSite?.id === site.id ? 'bg-blue-50' : 'hover:bg-gray-50'}"
                    data-site-id="${site.id}"
                >
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-medium text-sm ${selectedSite?.id === site.id ? 'text-blue-700' : 'text-gray-800'}">${site.name}</p>
                            <p class="text-xs text-gray-500">${site.manufacturer}</p>
                        </div>
                        ${selectedSite?.id === site.id ? `
                            <svg class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z" />
                            </svg>
                        ` : ''}
                    </div>
                </div>
            `).join('');

            document.getElementById('siteCountDisplay').textContent = `${filteredSites.length}개`;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Site search
            document.getElementById('siteSearchInput').addEventListener('input', (e) => {
                renderSiteList(e.target.value);
            });

            // Site selection
            document.getElementById('siteList').addEventListener('click', (e) => {
                const siteItem = e.target.closest('.site-item');
                if (!siteItem) return;

                const siteId = siteItem.dataset.siteId;
                selectSite(siteId);
            });

            // Tab switching
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tab = btn.dataset.tab;
                    switchTab(tab);
                });
            });
        }

        // Select site
        function selectSite(siteId) {
            selectedSite = sites.find(s => s.id === siteId);
            selectedLeftItems = [];
            selectedRightItems = [];
            leftSearchKeyword = '';
            rightSearchKeyword = '';
            permissionSearchKeyword = '';

            // Update UI
            renderSiteList(document.getElementById('siteSearchInput').value);

            // Show content area
            document.getElementById('emptyState').classList.add('hidden');
            document.getElementById('contentArea').classList.remove('hidden');

            // Update header
            document.getElementById('selectedSiteName').textContent = selectedSite.name;
            document.getElementById('selectedSiteManufacturer').textContent = `제조사: ${selectedSite.manufacturer}`;

            // Update counts
            document.querySelectorAll('.order-count').forEach(el => el.textContent = selectedSite.orderCount);
            document.querySelectorAll('.product-count').forEach(el => el.textContent = selectedSite.productCount);
            document.querySelectorAll('.permission-count').forEach(el => el.textContent = selectedSite.permissionCount);

            // Load active tab
            switchTab(activeTab);
        }

        // Switch tab
        function switchTab(tab) {
            activeTab = tab;
            selectedLeftItems = [];
            selectedRightItems = [];
            leftSearchKeyword = '';
            rightSearchKeyword = '';
            permissionSearchKeyword = '';

            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                if (btn.dataset.tab === tab) {
                    btn.classList.add('border-blue-500', 'text-blue-600');
                    btn.classList.remove('border-transparent', 'text-gray-500');
                } else {
                    btn.classList.remove('border-blue-500', 'text-blue-600');
                    btn.classList.add('border-transparent', 'text-gray-500');
                }
            });

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            if (tab === 'order') {
                document.getElementById('orderTab').classList.remove('hidden');
                renderTransferList('orderTab', registeredOrders, unregisteredOrders, '등록된 ORDER', '미등록 ORDER');
            } else if (tab === 'product') {
                document.getElementById('productTab').classList.remove('hidden');
                renderTransferList('productTab', registeredProducts, unregisteredProducts, '등록된 제품', '미등록 제품');
            } else if (tab === 'permission') {
                document.getElementById('permissionTab').classList.remove('hidden');
                renderPermissionTree();
            }
        }

        // Render transfer list
        function renderTransferList(containerId, leftItems, rightItems, leftTitle, rightTitle) {
            const container = document.getElementById(containerId);
            
            container.innerHTML = `
                <div class="flex gap-4 h-full">
                    <!-- Left: Registered Items -->
                    <div class="flex-1 flex flex-col border border-gray-200 rounded-lg overflow-hidden bg-white">
                        <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium text-gray-800 text-sm">
                                    <span class="left-title">${leftTitle}</span> 
                                    (<span class="left-visible-count">${leftItems.length}</span>/<span class="left-total-count">${leftItems.length}</span>)
                                </span>
                                <button
                                    class="delete-btn px-3 py-1 rounded text-xs font-medium bg-gray-200 text-gray-400"
                                    disabled
                                >
                                    삭제
                                </button>
                            </div>
                            <div class="relative">
                                <input
                                    type="text"
                                    class="left-search w-full border border-gray-300 rounded px-3 py-1.5 pl-8 text-xs focus:ring-2 focus:ring-blue-500 focus:outline-none"
                                    placeholder="번호 또는 명칭 검색..."
                                />
                                <svg class="w-3.5 h-3.5 text-gray-400 absolute left-2.5 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                                <button class="left-clear-btn hidden absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="flex-1 overflow-y-auto custom-scrollbar">
                            <table class="w-full text-sm">
                                <thead class="bg-gray-50 sticky top-0">
                                    <tr class="border-b border-gray-200">
                                        <th class="w-10 py-2 px-3">
                                            <input type="checkbox" class="left-select-all w-4 h-4 rounded" />
                                        </th>
                                        <th class="py-2 px-3 text-left text-gray-600">번호</th>
                                        <th class="py-2 px-3 text-left text-gray-600">명칭</th>
                                    </tr>
                                </thead>
                                <tbody class="left-tbody">
                                    <!-- Items will be rendered here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Arrows -->
                    <div class="flex flex-col items-center justify-center gap-2">
                        <button class="move-left-btn p-2 border border-gray-300 rounded hover:bg-gray-100">
                            <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                            </svg>
                        </button>
                        <button class="move-right-btn p-2 border border-gray-300 rounded hover:bg-gray-100">
                            <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </button>
                    </div>

                    <!-- Right: Unregistered Items -->
                    <div class="flex-1 flex flex-col border border-gray-200 rounded-lg overflow-hidden bg-white">
                        <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium text-gray-800 text-sm">
                                    <span class="right-title">${rightTitle}</span> 
                                    (<span class="right-visible-count">${rightItems.length}</span>/<span class="right-total-count">${rightItems.length}</span>)
                                </span>
                                <button
                                    class="register-btn px-3 py-1 rounded text-xs font-medium bg-gray-200 text-gray-400"
                                    disabled
                                >
                                    등록
                                </button>
                            </div>
                            <div class="relative">
                                <input
                                    type="text"
                                    class="right-search w-full border border-gray-300 rounded px-3 py-1.5 pl-8 text-xs focus:ring-2 focus:ring-blue-500 focus:outline-none"
                                    placeholder="번호 또는 명칭 검색..."
                                />
                                <svg class="w-3.5 h-3.5 text-gray-400 absolute left-2.5 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                                <button class="right-clear-btn hidden absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="flex-1 overflow-y-auto custom-scrollbar">
                            <table class="w-full text-sm">
                                <thead class="bg-gray-50 sticky top-0">
                                    <tr class="border-b border-gray-200">
                                        <th class="w-10 py-2 px-3">
                                            <input type="checkbox" class="right-select-all w-4 h-4 rounded" />
                                        </th>
                                        <th class="py-2 px-3 text-left text-gray-600">번호</th>
                                        <th class="py-2 px-3 text-left text-gray-600">명칭</th>
                                    </tr>
                                </thead>
                                <tbody class="right-tbody">
                                    <!-- Items will be rendered here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;

            // Render initial items
            renderTableItems(container, leftItems, rightItems);

            // Setup transfer list event listeners
            setupTransferListEvents(container, leftItems, rightItems);
        }

        // Render table items
        function renderTableItems(container, leftItems, rightItems) {
            const leftSearch = container.querySelector('.left-search').value.toLowerCase();
            const rightSearch = container.querySelector('.right-search').value.toLowerCase();

            const filteredLeft = leftItems.filter(item =>
                !leftSearch ||
                item.id.toLowerCase().includes(leftSearch) ||
                item.name.toLowerCase().includes(leftSearch)
            );

            const filteredRight = rightItems.filter(item =>
                !rightSearch ||
                item.id.toLowerCase().includes(rightSearch) ||
                item.name.toLowerCase().includes(rightSearch)
            );

            // Render left table
            const leftTbody = container.querySelector('.left-tbody');
            leftTbody.innerHTML = filteredLeft.length > 0 ? filteredLeft.map(item => `
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-2 px-3">
                        <input type="checkbox" class="left-checkbox w-4 h-4 rounded" data-item-id="${item.id}" />
                    </td>
                    <td class="py-2 px-3 text-gray-600 font-mono text-xs">${item.id}</td>
                    <td class="py-2 px-3 text-gray-800 truncate max-w-[180px]" title="${item.name}">${item.name}</td>
                </tr>
            `).join('') : `
                <tr>
                    <td colspan="3" class="py-8 text-center text-gray-400 text-sm">
                        ${leftSearch ? '검색 결과가 없습니다' : '등록된 항목이 없습니다'}
                    </td>
                </tr>
            `;

            // Render right table
            const rightTbody = container.querySelector('.right-tbody');
            rightTbody.innerHTML = filteredRight.length > 0 ? filteredRight.map(item => `
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-2 px-3">
                        <input type="checkbox" class="right-checkbox w-4 h-4 rounded" data-item-id="${item.id}" />
                    </td>
                    <td class="py-2 px-3 text-gray-600 font-mono text-xs">${item.id}</td>
                    <td class="py-2 px-3 text-gray-800 truncate max-w-[180px]" title="${item.name}">${item.name}</td>
                </tr>
            `).join('') : `
                <tr>
                    <td colspan="3" class="py-8 text-center text-gray-400 text-sm">
                        ${rightSearch ? '검색 결과가 없습니다' : '미등록 항목이 없습니다'}
                    </td>
                </tr>
            `;

            // Update counts
            container.querySelector('.left-visible-count').textContent = filteredLeft.length;
            container.querySelector('.left-total-count').textContent = leftItems.length;
            container.querySelector('.right-visible-count').textContent = filteredRight.length;
            container.querySelector('.right-total-count').textContent = rightItems.length;

            // Update clear buttons visibility
            container.querySelector('.left-clear-btn').classList.toggle('hidden', !leftSearch);
            container.querySelector('.right-clear-btn').classList.toggle('hidden', !rightSearch);
        }

        // Setup transfer list events
        function setupTransferListEvents(container, leftItems, rightItems) {
            // Left search
            const leftSearch = container.querySelector('.left-search');
            leftSearch.addEventListener('input', () => {
                renderTableItems(container, leftItems, rightItems);
            });

            // Right search
            const rightSearch = container.querySelector('.right-search');
            rightSearch.addEventListener('input', () => {
                renderTableItems(container, leftItems, rightItems);
            });

            // Clear buttons
            container.querySelector('.left-clear-btn').addEventListener('click', () => {
                leftSearch.value = '';
                renderTableItems(container, leftItems, rightItems);
            });

            container.querySelector('.right-clear-btn').addEventListener('click', () => {
                rightSearch.value = '';
                renderTableItems(container, leftItems, rightItems);
            });

            // Select all left
            container.querySelector('.left-select-all').addEventListener('change', (e) => {
                const checkboxes = container.querySelectorAll('.left-checkbox');
                checkboxes.forEach(cb => cb.checked = e.target.checked);
                updateLeftSelection(container);
            });

            // Select all right
            container.querySelector('.right-select-all').addEventListener('change', (e) => {
                const checkboxes = container.querySelectorAll('.right-checkbox');
                checkboxes.forEach(cb => cb.checked = e.target.checked);
                updateRightSelection(container);
            });

            // Individual checkboxes
            container.addEventListener('change', (e) => {
                if (e.target.classList.contains('left-checkbox')) {
                    updateLeftSelection(container);
                } else if (e.target.classList.contains('right-checkbox')) {
                    updateRightSelection(container);
                }
            });
        }

        // Update left selection
        function updateLeftSelection(container) {
            const checkboxes = Array.from(container.querySelectorAll('.left-checkbox'));
            const checkedCount = checkboxes.filter(cb => cb.checked).length;
            const deleteBtn = container.querySelector('.delete-btn');

            if (checkedCount > 0) {
                deleteBtn.disabled = false;
                deleteBtn.classList.remove('bg-gray-200', 'text-gray-400');
                deleteBtn.classList.add('bg-red-500', 'text-white', 'hover:bg-red-600');
                deleteBtn.textContent = `삭제 (${checkedCount})`;
            } else {
                deleteBtn.disabled = true;
                deleteBtn.classList.add('bg-gray-200', 'text-gray-400');
                deleteBtn.classList.remove('bg-red-500', 'text-white', 'hover:bg-red-600');
                deleteBtn.textContent = '삭제';
            }
        }

        // Update right selection
        function updateRightSelection(container) {
            const checkboxes = Array.from(container.querySelectorAll('.right-checkbox'));
            const checkedCount = checkboxes.filter(cb => cb.checked).length;
            const registerBtn = container.querySelector('.register-btn');

            if (checkedCount > 0) {
                registerBtn.disabled = false;
                registerBtn.classList.remove('bg-gray-200', 'text-gray-400');
                registerBtn.classList.add('bg-blue-500', 'text-white', 'hover:bg-blue-600');
                registerBtn.textContent = `등록 (${checkedCount})`;
            } else {
                registerBtn.disabled = true;
                registerBtn.classList.add('bg-gray-200', 'text-gray-400');
                registerBtn.classList.remove('bg-blue-500', 'text-white', 'hover:bg-blue-600');
                registerBtn.textContent = '등록';
            }
        }

        // Render permission tree
        function renderPermissionTree() {
            const container = document.getElementById('permissionTab');

            container.innerHTML = `
                <div class="bg-white border border-gray-200 rounded-lg h-full flex flex-col overflow-hidden">
                    <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm text-red-600">※ 제조사명 선택 검색후 데이터를 저장하세요.</span>
                            <button class="select-all-permissions px-3 py-1 border border-gray-300 rounded text-xs font-medium text-gray-700 hover:bg-gray-100">
                                전체선택
                            </button>
                        </div>
                        <div class="relative">
                            <input
                                type="text"
                                class="permission-search w-full border border-gray-300 rounded px-3 py-1.5 pl-8 text-xs focus:ring-2 focus:ring-blue-500 focus:outline-none"
                                placeholder="권한명 검색..."
                            />
                            <svg class="w-3.5 h-3.5 text-gray-400 absolute left-2.5 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                            <button class="permission-clear-btn hidden absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="flex-1 overflow-y-auto custom-scrollbar permission-list">
                        <!-- Permission tree will be rendered here -->
                    </div>
                </div>
            `;

            renderPermissionItems(container);
            setupPermissionEvents(container);
        }

        // Render permission items
        function renderPermissionItems(container) {
            const search = container.querySelector('.permission-search').value.toLowerCase();
            const permissionList = container.querySelector('.permission-list');

            const filteredPermissions = permissions.filter(p => {
                if (!search) return true;
                const matchParent = p.name.toLowerCase().includes(search);
                const matchChildren = p.children.some(c => c.name.toLowerCase().includes(search));
                return matchParent || matchChildren;
            });

            if (filteredPermissions.length === 0) {
                permissionList.innerHTML = `
                    <div class="py-8 text-center text-gray-400 text-sm">
                        검색 결과가 없습니다
                    </div>
                `;
                return;
            }

            permissionList.innerHTML = filteredPermissions.map(p => {
                const filteredChildren = search
                    ? p.children.filter(c => c.name.toLowerCase().includes(search))
                    : p.children;
                const showAllChildren = !search || p.name.toLowerCase().includes(search);
                const childrenToShow = showAllChildren ? p.children : filteredChildren;

                return `
                    <div class="border-b border-gray-100">
                        <div class="flex items-center gap-2 px-4 py-2 hover:bg-gray-50 cursor-pointer permission-parent" data-permission-id="${p.id}">
                            ${p.children.length > 0 ? `
                                <svg class="w-4 h-4 text-gray-400 transition-transform expand-icon ${expandedPermissions.includes(p.id) ? 'rotate-90' : ''}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                </svg>
                            ` : '<div class="w-4"></div>'}
                            <input type="checkbox" ${p.checked ? 'checked' : ''} class="parent-checkbox w-4 h-4 rounded" data-permission-id="${p.id}" />
                            <span class="text-sm text-gray-700">${p.name}</span>
                        </div>
                        ${expandedPermissions.includes(p.id) && p.children.length > 0 ? `
                            <div class="bg-gray-50 border-t border-gray-100">
                                ${childrenToShow.map(c => `
                                    <div class="flex items-center gap-2 px-4 py-2 pl-12 hover:bg-gray-100">
                                        <input type="checkbox" ${c.checked ? 'checked' : ''} class="child-checkbox w-4 h-4 rounded" data-permission-id="${c.id}" data-parent-id="${p.id}" />
                                        <span class="text-sm text-gray-600">${c.name}</span>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');

            container.querySelector('.permission-clear-btn').classList.toggle('hidden', !search);
        }

        // Setup permission events
        function setupPermissionEvents(container) {
            // Search
            const searchInput = container.querySelector('.permission-search');
            searchInput.addEventListener('input', () => {
                renderPermissionItems(container);
            });

            // Clear button
            container.querySelector('.permission-clear-btn').addEventListener('click', () => {
                searchInput.value = '';
                renderPermissionItems(container);
            });

            // Select all
            container.querySelector('.select-all-permissions').addEventListener('click', () => {
                permissions.forEach(p => {
                    p.checked = true;
                    p.children.forEach(c => c.checked = true);
                });
                renderPermissionItems(container);
            });

            // Parent expand/collapse
            container.addEventListener('click', (e) => {
                const parent = e.target.closest('.permission-parent');
                if (parent && !e.target.classList.contains('parent-checkbox')) {
                    const permissionId = parent.dataset.permissionId;
                    const permission = permissions.find(p => p.id === permissionId);
                    
                    if (permission && permission.children.length > 0) {
                        if (expandedPermissions.includes(permissionId)) {
                            expandedPermissions = expandedPermissions.filter(id => id !== permissionId);
                        } else {
                            expandedPermissions.push(permissionId);
                        }
                        renderPermissionItems(container);
                    }
                }
            });

            // Parent checkbox
            container.addEventListener('change', (e) => {
                if (e.target.classList.contains('parent-checkbox')) {
                    const permissionId = e.target.dataset.permissionId;
                    const permission = permissions.find(p => p.id === permissionId);
                    if (permission) {
                        permission.checked = e.target.checked;
                        renderPermissionItems(container);
                    }
                }
            });

            // Child checkbox
            container.addEventListener('change', (e) => {
                if (e.target.classList.contains('child-checkbox')) {
                    const childId = e.target.dataset.permissionId;
                    const parentId = e.target.dataset.parentId;
                    const parent = permissions.find(p => p.id === parentId);
                    if (parent) {
                        const child = parent.children.find(c => c.id === childId);
                        if (child) {
                            child.checked = e.target.checked;
                            renderPermissionItems(container);
                        }
                    }
                }
            });
        }

        // Save handler
        function handleSave() {
            alert('저장되었습니다!');
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>